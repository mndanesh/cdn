window.addEventListener("load",function(){var e,t=document.querySelector("#main-clone"),r=document.querySelector("#form-comment"),n=document.querySelector("#more-comments"),i=0;$.get("https://api2.abin.ir/ProductAdditionalNote?productId="+main.dataset.productId,function(e){e.length>0&&$("#gift").removeAttr("hidden"),$(e).each(function(e){var t=$(this)[0].price,r=$(this)[0].note;$(this)[0].icon,$(this)[0].gifturl,null==t?$(".gifts").append('<div class="row"><a class="col h6" data-gift-id="10">'+r+'</a><div class="col h6"></div></div>'):$(".gifts").append('<div class="row"><a class="col h6" data-gift-id="10">'+r+'</a><div class="col h6"><span class="gift-price">'+t+"</span>تومان</div></div>")}),console.log(e)},"json");var o=document.querySelector("#zoom-result");function a(t){if(t&&t.preventDefault(),!e||!e.parentNode)return!1;o.hidden=!0,e.parentNode.removeChild(e)}/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&$(".swiper-slide").click(function(e){e.preventDefault(),$(d).modal("show")});var s=document.querySelector("#detail-slider");function l(e){for(var t=new Swiper(e.querySelector(".swiper-container"),{slidesPerView:1,autoplay:!1,loop:!0,on:{slideChange:function(){var e=this.slides[this.activeIndex],t=this.slides[this.previousIndex];if(t&&t.classList.contains("video")){var r=t.querySelector("video");r&&r.pause()}if(e&&e.classList.contains("video")){var r=e.querySelector("video");r&&r.play()}a()}}}),r=e.querySelectorAll(".sidebar > .items > .item"),n=0;n<r.length;n++)r[n].addEventListener("click",function(e){e.preventDefault();var r=Array.prototype.slice.call(this.parentNode.children).indexOf(this);t.slideToLoop(r)})}s.querySelector(".swiper-container").addEventListener("mouseenter",function(t){t.preventDefault(),function t(r){var n,i;function a(t){var a,s,l,d,c,u,v;t.preventDefault(),s=(a=(d=t,u=0,v=0,d=d||window.event,c=r.getBoundingClientRect(),u=d.pageX-c.left,v=d.pageY-c.top,{x:u-=window.pageXOffset,y:v-=window.pageYOffset})).x-e.offsetWidth/2,l=a.y-e.offsetHeight/2,s>r.width-e.offsetWidth&&(s=r.width-e.offsetWidth),s<0&&(s=0),l>r.height-e.offsetHeight&&(l=r.height-e.offsetHeight),l<0&&(l=0),e.style.left=s+"px",e.style.top=l+"px",o.style.backgroundPosition="-"+(s*n-50)+"px -"+(l*i-30)+"px"}o.hidden=!1,(e=document.createElement("DIV")).id="img-zoom-lens",r.parentElement.insertBefore(e,r),n=o.offsetWidth/e.offsetWidth,i=o.offsetHeight/e.offsetHeight,o.style.backgroundImage="url('"+(r.dataset.srcLg?r.dataset.srcLg:r.src)+"')",o.style.backgroundSize=r.width*n+"px "+r.height*i+"px",e.addEventListener("mousemove",a),r.addEventListener("mousemove",a),e.addEventListener("touchmove",a),r.addEventListener("touchmove",a)}(s.querySelector(".swiper-slide-active img"))}),s.querySelector(".swiper-container").addEventListener("mouseleave",function(e){e.preventDefault(),a()});var d=document.querySelector("#slider-modal");d.querySelector(".modal-body").innerHTML=s.innerHTML;var c=s.querySelector(".sidebar a.item.more");c&&c.addEventListener("click",function(e){e.preventDefault(),$(d).modal("show")}),l(s),$(d).on("shown.bs.modal",function(){l(this.querySelector(".modal-body"))}),generateProductActions(s);var u=document.querySelector("#detail #attrs .more > a"),v=document.querySelector("#detail #attrs .less > a"),p=document.querySelectorAll("#detail #attrs .more ~ li");u&&(u.addEventListener("click",function(e){e.preventDefault();for(var t=0;t<p.length;t++)p[t].classList.add("show");u.parentNode.hidden=!0}),v.addEventListener("click",function(e){e.preventDefault(),u.parentNode.hidden=!1;for(var t=0;t<p.length;t++)p[t].classList.remove("show")}));var m=document.querySelector("#other-providers a.more"),f=document.querySelectorAll("#other-providers .more-wrapper ~ article");m&&m.addEventListener("click",function(e){e.preventDefault();for(var t=0;t<f.length;t++)f[t].classList.add("show");m.parentNode.hidden=!0});var h=document.querySelector("#install .more > a.more-link");function g(e){e.preventDefault();var t=e.target.closest("a"),r=t.classList.contains("like")?"like":"dislike",n=t.closest(".comment").querySelector("like"==r?".dislike":".like");if(n.classList.contains("selected")){n.classList.remove("selected");var i=n.closest("div").querySelector(".value");i.innerHTML=parseInt(i.innerHTML)-1}var o=t.closest("div").querySelector(".value"),a=t.classList.contains("selected")?-1:1;o.innerHTML=parseInt(o.innerHTML)+a,t.classList.toggle("selected");var s=new XMLHttpRequest;function l(){$("#comment-toast-error").toast("show"),o.innerHTML=parseInt(o.innerHTML)-a,t.classList.toggle("selected")}s.addEventListener("load",function(e){this.status>=200&&this.status<400?($("#comment-toast").toast("show"),JSON.parse(this.response)):l()}),s.addEventListener("error",function(e){l()}),s.open("POST",config[mode].baseURL+"/productcommentvote/"+(1==a?"":"Remove")+("like"==r?"VoteUp":"VoteDown")+"Comment?id="+t.closest(".row.comment").dataset.commentId),s.send()}h&&h.addEventListener("click",function(e){e.preventDefault(),h.parentNode.classList.toggle("less")}),new Swiper("#related-products .swiper-container",{slidesPerView:4,spaceBetween:15,autoplay:!0,loop:!0,navigation:{nextEl:document.querySelector("#related-products .swiper-button-next"),prevEl:document.querySelector("#related-products .swiper-button-prev")},breakpoints:{992:{slidesPerView:"auto"}}}),btnShowCommentModal.addEventListener("click",function(){r.elements.parentId.value="0"});var y=document.querySelector("#btn-service"),S=document.querySelector("#buy-modal");y&&y.addEventListener("click",function(e){e.preventDefault(),$(S).modal("show")}),$(document.querySelector("#detail-tabs")).find('a[data-toggle="tab"]').on("show.bs.tab",function(e){var t=e.target;switch(t.getAttribute("href")){case"#price-chart-wrapper":if(t.classList.contains("loaded"))break;t.classList.add("loaded"),$.when($.getScript("/plugin/Highcharts-7.2.1/code/highcharts.js"),$.getScript("/plugin/Highcharts-7.2.1/code/modules/series-label.js"),$.getScript("/plugin/Highcharts-7.2.1/code/modules/exporting.js"),$.getScript("/plugin/Highcharts-7.2.1/code/modules/export-data.js"),$.getScript("/plugin/moment/moment.min.js"),$.getScript("/plugin/moment/moment-jalaali.js"),$.Deferred(function(e){$(e.resolve)})).done(function(){moment.loadPersian();var e=new XMLHttpRequest,t=document.querySelector("#price-chart");e.addEventListener("load",function(e){var r=JSON.parse(event.target.responseText);if(r&&r.ProductPrices&&r.ProductPrices.length){var n=[];t.innerHTML="";for(var i=0;i<r.ProductPrices.length;i++){var o=r.ProductPrices[i];n[i]={},n[i].name=o.StoreName,n[i].data=[];for(var a=o.Prices,s=0;s<a.length;s++){var l=a[s];n[i].data.push([new Date(moment(l.m_Item1,"jYYYY/jM/jD").format("YYYY-M-D HH:mm:ss")).getTime(),parseInt(l.m_Item2),])}}Highcharts.setOptions({lang:{thousandsSep:","}}),Highcharts.chart("price-chart",{title:{text:""},xAxis:{type:"datetime",labels:{formatter:function(){return moment(this.value).format("jMMMM jYYYY")}}},yAxis:{title:{text:"قیمت"},crosshair:!0,labels:{formatter:function(){return new Intl.NumberFormat("fa-FA").format(this.value)}}},legend:{layout:"vertical",align:"right",verticalAlign:"middle"},plotOptions:{series:{label:{connectorAllowed:!1},marker:{enabled:!0,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}}},series:n,tooltip:{formatter:function(){return new Date(this.x).toLocaleDateString("fa")+" - <strong>"+this.series.name+":</strong>  <strong>"+new Intl.NumberFormat("fa-FA").format(this.y)+"</strong>"}},responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{layout:"horizontal",align:"center",verticalAlign:"bottom"}}},]}})}}),e.open("GET",config[mode].baseURL+"/productprice?$format=json&id="+main.dataset.productId),e.send()});break;case"#comments":if(t.classList.contains("loaded"))break;t.classList.add("loaded"),w()}});var L=document.querySelector("#comment-modal");function q(e){e.querySelector(".after").style.width="calc("+(100-parseInt(e.querySelector("input").value))+"% - 6px)"}function w(){var e=new XMLHttpRequest;e.addEventListener("load",function(e){loading.hidden=!0;var r=JSON.parse(event.target.responseText);if(r&&r.ProductComments&&r.ProductComments.length)E(r.ProductComments),r.ProductComments.length<2&&(n.hidden=!0);else if(n.hidden=!0,0==i){var o=t.querySelector(".not-found").cloneNode(!0);commentsEl.appendChild(o)}}),e.open("GET",config[mode].newBaseURL+"/productcomment?$format=json&id="+main.dataset.productId+"&take=2&skip="+2*i),e.send(),loading.hidden=!1}$(L).on("show.bs.modal",function(){if(!L.classList.contains("loaded")){for(var e=L.querySelectorAll(".rate > .row"),t=0;t<e.length;t++)q(e[t]),e[t].querySelector("input").addEventListener("change",function(){q(this.closest(".row")),this.closest(".row").querySelector(".rate-percent").innerHTML=1==this.value?"بد":2==this.value?"ضعیف":3==this.value?"متوسط":4==this.value?"خوب":5==this.value?"عالی":""});L.classList.add("loaded"),r.addEventListener("submit",function(e){e.preventDefault();var t=new XMLHttpRequest,n=$(this).serialize();t.addEventListener("load",function(e){if(e.target.responseText){var t=JSON.parse(e.target.responseText);t.ProductComments&&E(t.ProductComments)}$("#comment-toast").toast("show"),$(L).modal("hide"),r.reset()}),t.addEventListener("error",function(e){}),t.open(this.method,config[mode].baseURL+this.getAttribute("action")+"?"+n),t.send(n)})}}),n.addEventListener("click",function(e){e.preventDefault(),w(++i)});var b=document.querySelector("#gift");if(b){var k=document.querySelector("#gift-modal");b.querySelector(".more").addEventListener("click",function(e){e.preventDefault(),b.classList.toggle("closed")}),$(k).on("hidden.bs.modal",function(){var e=k.querySelector("[data-gift-id]:not([hidden])");e&&(e.hidden=!0)});var P=b.querySelectorAll(".gifts a");for(var T in P)P.hasOwnProperty(T)&&P[T].addEventListener("click",function(e){e.preventDefault();var t=this.dataset.giftId,r=k.querySelector('[data-gift-id="'+t+'"]');r&&(r.hidden=!1),$(k).modal("show")})}function E(e){for(var n=t.querySelector(".row.comment"),i=0;i<e.length;i++){var o=e[i],a=n.cloneNode(!0);a.dataset.commentId=o.Id;var s=a.querySelector(".img img");s.alt=s.title=o.SenderName,s.src=o.SenderProfileImage,a.querySelector(".reply").setAttribute("data-id",o.Id),a.querySelector(".sender-name").innerHTML=o.SenderName;var l=a.querySelector("time");l.setAttribute("time",o.Date),l.innerHTML=o.Date.substring(0,10);var d=o.Date.substring(11,o.Date.length).split(" ");if(a.querySelector(".time").innerHTML=d[0]+" "+("PM"==d[1]?"ب.ظ":"ق.ظ"),o.IsBuyer&&a.querySelector(".buyed")?a.querySelector(".buyed").hidden=!1:a.querySelector(".guest").hidden=!0,o.IsBuyer){var c=a.querySelector(".price .val");c.innerHTML=new Intl.NumberFormat("fa-FA").format(o.BuyPrice)}else{var c=a.querySelector(".price");c.hidden=!0}if(o.GoodPoints&&o.GoodPoints.length){var u=a.querySelector(".advantages");u.hidden=!1;for(var v=0;v<o.GoodPoints.length;v++){var p=document.createElement("li");p.innerHTML=o.GoodPoints[v].PointText,u.querySelector("ul").appendChild(p)}}if(o.BadPoints&&o.BadPoints.length){var m=a.querySelector(".disadvantages");m.hidden=!1;for(var f=0;f<o.BadPoints.length;f++){var p=document.createElement("li");p.innerHTML=o.BadPoints[f].PointText,m.querySelector("ul").appendChild(p)}}if(o.Replies&&o.Replies.length){var h=a.querySelector(".replies");h.hidden=!1;for(var y=0;y<o.Replies.length;y++){var S=o.Replies[y],q=a.querySelector(".comment-reply").cloneNode(!0);q.hidden=!1,q.querySelector(".sender-name").innerHTML=S.SenderName;var l=q.querySelector("time");l.setAttribute("time",S.Date),l.innerHTML=S.Date.substring(0,10),q.querySelector(".body").innerHTML=S.Body,h.appendChild(q)}}var w=a.querySelector(".rating");w.querySelector(".starrr").setAttribute("data-star",o.TotalRate),w.querySelector(".text-hide").innerHTML=o.TotalRate,a.querySelector(".body").innerHTML=o.CommentBody,a.querySelector(".reply").addEventListener("click",function(e){e.preventDefault(),r.elements.parentId.value=$(this).attr("data-id"),$(L).modal("show")});var b=a.querySelector(".like-wrapper");b.querySelector(".like-rate .value").innerHTML=o.RateUp,b.querySelector(".dislike-rate .value").innerHTML=o.RateDown,o.TurnVoteUpOn&&b.querySelector(".like").classList.add("selected"),b.querySelector(".like").addEventListener("click",function(e){g(e)}),b.querySelector(".dislike").addEventListener("click",function(e){g(e)}),o.TurnVoteDownOn&&b.querySelector(".dislike").classList.add("selected"),commentsEl.appendChild(a)}}});
window.addEventListener("load",function(){new Swiper("#top-products .swiper-container",{slidesPerView:4,autoplay:{delay:11e3},speed:600,loop:!0,spaceBetween:15,breakpoints:{992:{slidesPerView:3},767:{slidesPerView:1}}}),window.outerWidth<767&&new Swiper("#amazing .swiper-container",{slidesPerView:1,autoplay:{delay:11e3},speed:600,loop:!0});var e,t,r=document.querySelector("#amazing .countdown");r&&(e=new easytimer.Timer,t=r.innerHTML.split(":"),e.start({countdown:!0,startValues:{seconds:3600*parseInt(t[0])+60*parseInt(t[1])+parseInt(t[2])}}),e.addEventListener("secondsUpdated",function(t){r.innerHTML='<span class="px-md-1">'+e.getTimeValues().hours+'</span>:<span class="px-md-1">'+e.getTimeValues().minutes+'</span>:<span class="px-md-1">'+e.getTimeValues().seconds+"</span>"}));var n=document.querySelector("#form-search"),o=document.querySelector("#results");function s(e){fetchProducts(decodeURIComponent($.param($(n).serializeArray().filter(function(e){return e.value}))),function(t,r,s){return s?fillGridProducts(null,null,!0):void fillGridProducts(r,n,o,s,e?o.querySelector(".loading"):loading)},e?o.querySelector(".loading"):loading)}n.addEventListener("submit",function(e){e.preventDefault(),o.scrollIntoView&&o.scrollIntoView(),s()}),s(!0)}),window.addEventListener("load",function(){var e=document.querySelector("#more-comments"),t=0,r=document.querySelector("#form-comment"),n=document.querySelector("#form-commentModal");function o(e){e.preventDefault();var t=e.target.closest("a"),r=t.classList.contains("like")?"like":"dislike",e=t.closest(".comment").querySelector("like"==r?".dislike":".like");e.classList.contains("selected")&&(e.classList.remove("selected"),(s=e.closest("div").querySelector(".value")).innerHTML=parseInt(s.innerHTML)-1);var n=t.closest("div").querySelector(".value"),o=t.classList.contains("selected")?-1:1;n.innerHTML=parseInt(n.innerHTML)+o,t.classList.toggle("selected");var s=new XMLHttpRequest;function i(){$("#comment-toast-error").toast("show"),n.innerHTML=parseInt(n.innerHTML)-o,t.classList.toggle("selected")}s.addEventListener("load",function(e){200<=this.status&&this.status<400?($("#comment-toast").toast("show"),JSON.parse(this.response)):i()}),s.addEventListener("error",function(e){i()}),s.open("POST",config[mode].baseURL+"/productcommentvote/"+(1==o?"":"Remove")+("like"==r?"VoteUp":"VoteDown")+"Comment?id="+t.closest(".row.comment").dataset.commentId),s.send()}function s(){var r=new XMLHttpRequest;r.addEventListener("load",function(r){loading.hidden=!0;var n=JSON.parse(event.target.responseText);n&&n.ProductComments&&n.ProductComments.length?(l(n.ProductComments),n.ProductComments.length<9999&&(e.hidden=!0)):(e.hidden=!0,0==t&&(n=mainClone.querySelector(".not-found").cloneNode(!0),commentsEl.appendChild(n)))}),r.open("GET",config[mode].newBaseURL+"/productcomment?$format=json&categoryId="+main.dataset.categoryId+"&take=9999&skip="+2*t),r.send(),loading.hidden=!1}e.addEventListener("click",function(e){e.preventDefault(),t++,s()}),s(),r.elements.categoryid.value=main.dataset.categoryId,r.addEventListener("submit",function(e){e.preventDefault();var t=new XMLHttpRequest,e=$(this).serialize();t.addEventListener("load",function(e){200<=this.status&&this.status<400?(!e.target.responseText||(e=JSON.parse(e.target.responseText)).ProductComments&&l(e.ProductComments),$("#comment-toast").toast("show"),r.reset()):$("#comment-toast-error").toast("show")}),t.addEventListener("error",function(e){}),t.open(this.method,config[mode].baseURL+this.getAttribute("action")+"?"+e),t.send(e)}),n.addEventListener("submit",function(e){e.preventDefault();var t=new XMLHttpRequest,e=$(this).serialize();t.addEventListener("load",function(e){200<=this.status&&this.status<400?(!e.target.responseText||(e=JSON.parse(e.target.responseText)).ProductComments&&l(e.ProductComments),$("#comment-toast").toast("show"),n.reset()):$("#comment-toast-error").toast("show")}),t.addEventListener("error",function(e){}),t.open(this.method,config[mode].baseURL+this.getAttribute("action")+"?"+e),t.send(e)});var i=document.querySelector("#comment-modal");function a(e){e.querySelector(".after").style.width="calc("+(100-parseInt(e.querySelector("input").value))+"% - 6px)"}function l(e){for(var t=document.querySelector(".row.comment:last-child"),r=0;r<e.length;r++){var s=e[r],a=t.cloneNode(!0);a.removeAttribute("hidden"),a.dataset.commentId=s.Id;var l=a.querySelector(".img img");if(l.alt=l.title=s.SenderName,l.src=s.SenderProfileImage,a.querySelector(".sender-name").innerHTML=s.SenderName,a.querySelector(".reply").setAttribute("data-id",s.Id),(h=a.querySelector("time")).setAttribute("time",s.Date),h.innerHTML=s.Date.substring(0,10),l=s.Date.substring(11,s.Date.length).split(" "),a.querySelector(".time").innerHTML=l[0]+" "+("PM"==l[1]?"ب.ظ":"ق.ظ"),s.IsBuyer&&a.querySelector(".buyed")?a.querySelector(".buyed").hidden=!1:a.querySelector(".guest").hidden=!0,s.IsBuyer?a.querySelector(".price .val").innerHTML=new Intl.NumberFormat("fa-FA").format(s.BuyPrice):a.querySelector(".price").hidden=!0,s.GoodPoints&&s.GoodPoints.length){var d=a.querySelector(".advantages");d.hidden=!1;for(var c=0;c<s.GoodPoints.length;c++)(m=document.createElement("li")).innerHTML=s.GoodPoints[c].PointText,d.querySelector("ul").appendChild(m)}if(s.BadPoints&&s.BadPoints.length){var u=a.querySelector(".disadvantages");u.hidden=!1;for(var m,p=0;p<s.BadPoints.length;p++)(m=document.createElement("li")).innerHTML=s.BadPoints[p].PointText,u.querySelector("ul").appendChild(m)}if(console.log(s.Replies.length),s.Replies&&s.Replies.length){var y=a.querySelector(".replies");y.hidden=!1;for(var v=0;v<s.Replies.length;v++){var h,L=s.Replies[v],f=a.querySelector(".comment-reply").cloneNode(!0);f.hidden=!1,f.querySelector(".sender-name").innerHTML=L.SenderName,(h=f.querySelector("time")).setAttribute("time",L.Date),h.innerHTML=L.Date.substring(0,10),f.querySelector(".body").innerHTML=L.Body,y.appendChild(f)}}(l=a.querySelector(".rating")).querySelector(".starrr").setAttribute("data-star",s.TotalRate),l.querySelector(".text-hide").innerHTML=s.TotalRate,a.querySelector(".body").innerHTML=s.CommentBody,a.querySelector(".reply").addEventListener("click",function(e){e.preventDefault(),n.elements.parentId.value=$(this).attr("data-id"),$(i).modal("show")}),(l=a.querySelector(".like-wrapper")).querySelector(".like-rate .value").innerHTML=s.RateUp,l.querySelector(".dislike-rate .value").innerHTML=s.RateDown,s.TurnVoteUpOn&&l.querySelector(".like").classList.add("selected"),l.querySelector(".like").addEventListener("click",function(e){o(e)}),l.querySelector(".dislike").addEventListener("click",function(e){o(e)}),s.TurnVoteDownOn&&l.querySelector(".dislike").classList.add("selected"),commentsEl.appendChild(a)}}$(i).on("show.bs.modal",function(){if(!i.classList.contains("loaded")){for(var e=i.querySelectorAll(".rate > .row"),t=0;t<e.length;t++)a(e[t]),e[t].querySelector("input").addEventListener("change",function(){a(this.closest(".row")),this.closest(".row").querySelector(".rate-percent").innerHTML=this.value+"٪"});i.classList.add("loaded"),r.addEventListener("submit",function(e){e.preventDefault();var t=new XMLHttpRequest,e=$(this).serialize();t.addEventListener("load",function(e){!e.target.responseText||(e=JSON.parse(e.target.responseText)).ProductComments&&l(e.ProductComments),$("#comment-toast").toast("show"),$(i).modal("hide"),r.reset()}),t.addEventListener("error",function(e){}),t.open(this.method,config[mode].baseURL+this.getAttribute("action")+"?"+e),t.send(e)})}})});